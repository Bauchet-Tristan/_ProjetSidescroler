<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>yin and Yang</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var config = {
    type: Phaser.AUTO,
    width: 1500,
    height: 1000,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 350 },
            debug: true
        }
    },
    input:{gamepad:true},
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var player;
var wolf;
var test;

var platforms;
var ICE = false;
var SNOW = false;

//// Stat wolf ////
var timeMove = 0;
var speedWolf = 150; 


//// Stat joueur ////

// Life //
var lifeMax =6;
var life = 6;
var yin1;
var yin2;
var yin3;
var yin4;
var yin5;
var yin6;

// Spirit //
var spiritMax =6;
var spirit = 6;
var yang1;
var yang2;
var yang3;
var yang4;
var yang5;
var yang6;

// Speed //
var currentSpeed;
var speed = 220;
var speedICE = 300;
var speedSNOW = 120;


//  Compteurs //

//Saut//
var jump1 = 0;
var jump2 = 0;
var jumpAerien = 0;

//Dash attack
var dashAttackLeft = 0;
var dashAttackRight = 0;
var dashAerien = 0;
var tempDash = 0;

//  Input Events  //
var cursors;
var keyA;

//  Input Events Pad //
var paddleConnected = false ;
var paddle;

var gameOver = false;
var game = new Phaser.Game(config);



function preload ()
{
    this.load.image('life', 'assets/Yin.png');
    this.load.image('spirit', 'assets/Yang.png');

    this.load.image('sky', 'assets/sky.png');

    this.load.image('ground', 'assets/platform.png');
    this.load.image('groundICE', 'assets/platformICE.png');
    this.load.image('groundSNOW', 'assets/platformSNOW.png');

    this.load.spritesheet('dude', 'assets/dude.png', { frameWidth: 32, frameHeight: 48 });
    this.load.spritesheet('wolf', 'assets/wolf.png', { frameWidth: 32, frameHeight: 48 });
}



function create ()
{
  
    //  A simple background for our game
    this.add.image(400, 300, 'sky');

    //  The platforms group contains the ground and the ledges we can jump on
    platforms = this.physics.add.staticGroup();
    platformsICE = this.physics.add.staticGroup();
    platformsSNOW = this.physics.add.staticGroup();

    //
    platforms.create(400, 568, 'ground').setScale(2).refreshBody(); // LE SOL
    platformsSNOW.create(600, 410, 'groundSNOW'); // Plateform 1
    platformsICE.create(80, 250, 'groundICE'); // Plateform 2 
    platforms.create(740, 220, 'ground'); // Plateform 3


    // The player and its settings
    player = this.physics.add.sprite(375, 500, 'dude');
    player.setCollideWorldBounds(true);


    //Wolf
    wolf = this.physics.add.sprite(500, 500, 'wolf');
    wolf.setCollideWorldBounds(true);


    //  Our player animations, turning, walking left and walking right.
    this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('dude', { start: 0, end: 3 }),
        frameRate: 10,
        repeat: -1
    });

    this.anims.create({
        key: 'turn',
        frames: [ { key: 'dude', frame: 4 } ],
        frameRate: 20
    });

    this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('dude', { start: 5, end: 8 }),
        frameRate: 10,
        repeat: -1
    });


    //  Input Events  //
    cursors = this.input.keyboard.createCursorKeys();
    keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
    ////// end Input //////



///////////////////////////////        UI        /////////////////////////////// 

    //Camera
    this.cameras.main.setSize(1920,1080);
    
    // Life
    yin1 = this.add.image(0, 0, 'life');  
    yin2 = this.add.image(0, 0, 'life');  
    yin3 = this.add.image(0, 0, 'life');  
    yin4 = this.add.image(0, 0, 'life');  
    yin5 = this.add.image(0, 0, 'life');  
    yin6 = this.add.image(0, 0, 'life');  

    // Spirit
    yang1 = this.add.image(0, 0, 'spirit');  
    yang2 = this.add.image(0, 0, 'spirit');  
    yang3 = this.add.image(0, 0, 'spirit');  
    yang4 = this.add.image(0, 0, 'spirit');  
    yang5 = this.add.image(0, 0, 'spirit');  
    yang6 = this.add.image(0, 0, 'spirit');



////////////////////////////////////        COLLIDER        ////////////////////////////////////      


/////// Platforms Collider ///////

    // Collide the player with the platforms Green
    this.physics.add.collider(player, platforms,GroundGreen);

    // collide with wolf
    this.physics.add.collider(wolf, platforms,GroundGreen);
    
    // Collide the player with the platforms ICE
    this.physics.add.collider(player, platformsICE,GroundBlue);

    // Collide the player with the platforms SNOW 
    this.physics.add.collider(player, platformsSNOW,GroundWhite);


/////// Ennemi Collider ///////

    this.physics.add.collider(player, wolf,PlayerWolf);

}


function PlayerWolf ()
{
    console.log(life);
    life= life -1;
    player.setVelocityY(-100)
} 


//////////////////////////////////////////////////////// FUNCTION-UPDATE ////////////////////////////////////////////////////////

function update ()
{
    if (gameOver)
    {
        return;
    }

    this.input.gamepad.once('connected',function(pad)
    {
        paddleConnected = true ;
        paddle = pad ;
    });

/////////////////////////////////////  Camera - Interface  /////////////////////////////////////

    this.cameras.main.startFollow(player,false,0,0,-225,100);

//////// Barre de Vie ////////

    ////
    yin1.x = player.body.position.x + 70;
    yin1.y = player.body.position.y + 330;

    yin2.x = player.body.position.x + 145;
    yin2.y = player.body.position.y + 330;

    /////
    yin3.x = player.body.position.x + 220;
    yin3.y = player.body.position.y + 330;
    
    yin4.x = player.body.position.x + 295;
    yin4.y = player.body.position.y + 330;

    ////
    yin5.x = player.body.position.x + 370;
    yin5.y = player.body.position.y + 330;

    yin6.x = player.body.position.x + 445;
    yin6.y = player.body.position.y + 330;

//////// Barre d'spirit ////////

    ////
    yang1.x = player.body.position.x - 38;
    yang1.y = player.body.position.y + 330;

    yang2.x = player.body.position.x - 113;
    yang2.y = player.body.position.y + 330;

    /////
    yang3.x = player.body.position.x - 188;
    yang3.y = player.body.position.y + 330;
    
    yang4.x = player.body.position.x - 263;
    yang4.y = player.body.position.y + 330;

    ////
    yang5.x = player.body.position.x - 338;
    yang5.y = player.body.position.y + 330;

    yang6.x = player.body.position.x - 413;
    yang6.y = player.body.position.y + 330;



///////////////////////////////////////////////////////  Ennemie  ////////////////////////////////////////////////////////////

    // Ennemi patern
    
    timeMove = timeMove+1;


    if(timeMove <= 150)
    {
        wolf.setVelocityX(-160);

    }
    else if(timeMove > 150 && timeMove <= 300)
    {
        wolf.setVelocityX(0);
    }

    else if(timeMove > 300 && timeMove <= 450)
    {
        wolf.setVelocityX(160);
    } 
    else if(timeMove > 450 && timeMove <= 600)
    {
        wolf.setVelocityX(0);
    } 
    else
    {
        timeMove =  0;
    }

    

       

///////////////////////////////////////////////////////  Control Clavier /////////////////////////////////////////////////////

    

    if (paddleConnected == false)
    {

        if (cursors.left.isDown)
        {
            if(ICE == true)
            {
                currentSpeed = speedICE;
            }
            else if (SNOW == true)
            {
                currentSpeed = speedSNOW;
            }
            else
            {
                currentSpeed = speed;
            }

            player.setVelocityX(-currentSpeed);

            player.anims.play('left', true);
        }
        else if (cursors.right.isDown)
        {
            if(ICE == true)
            {
                currentSpeed = speedICE;
            }
            else if (SNOW == true)
            {
                currentSpeed = speedSNOW;
            }
            else
            {
                currentSpeed = speed;
            }

            player.setVelocityX(currentSpeed);

            player.anims.play('right', true);
        }
    
        //---------------//Sol normal//---------------//
        else if (ICE == false)
        {
            player.setVelocityX(0);

            player.anims.play('turn');
        }
    
        //---------------//Sol de glace//---------------//
        else if (ICE == true)
        {
            player.anims.play('turn');
        }

        //---------------// Saut //---------------//
        if (player.body.touching.down && cursors.space.isDown)
        {
            player.setVelocityY(-350); 
            jump1 = 1;
        }
        
        //---------------// Check relache Space ET debloque le deuxieme saut//---------------//   
        if(cursors.space.isUp && jump1 == 1)
        {
            jump2 = 1;
        }

        //---------------// Check si en l'air sans utiliser Saut 1 ET debloque le deuxieme saut//---------------//   
        if (!player.body.touching.down && jumpAerien == 0 && jump1 == 0)
        {
            jump1 = 1;
            jumpAerien = 1;
            jump2 = 1;
        }

        //---------------// Double Saut //---------------//  
        if (!player.body.touching.down && cursors.space.isDown && jump2 == 1) // quand on re APPUIS
        {
            player.setVelocityY(-250);
            jump1 = 0;
            jump2 = 0;
            jumpAerien = 1;
        }

        //---------------// reset si on a pas utiliser notre double saut //---------------// 
        if (player.body.touching.down && jump2 == 1 )
        {
            jump1 = 0;
            jump2 = 0;
        }

        //---------------// reset si on a pas utiliser notre sautAerien //---------------// 
        if (player.body.touching.down && jumpAerien == 1 )
        {
            jumpAerien =0;
        }
 


        //---------------// Dash Down //---------------//
        if (!player.body.touching.down && cursors.down.isDown)
            {
                player.setVelocityY(400);
            }


        //---------------// Dash attack //---------------//

        if (dashAerien == 0)
        {
            if (cursors.right.isDown && keyA.isDown && (dashAttackRight == 0 || dashAttackLeft == 0))
            { 
                dashAttackRight = 1;
            }

            if (cursors.left.isDown && keyA.isDown && (dashAttackRight == 0 || dashAttackLeft == 0))
            { 
                dashAttackLeft = 1;
            }


            if ((dashAttackRight == 1 || dashAttackLeft == 1) && tempDash < 9)
            {
                if(dashAttackRight == 1)
                {
                    player.setVelocityX(1500);
                }
                else if (dashAttackLeft == 1)
                {
                    player.setVelocityX(-1500);
                }
                tempDash++;
            }

            if (keyA.isUp && tempDash >= 9 && (dashAttackRight == 1 || dashAttackLeft == 1))
            {
                dashAttackLeft = 0;
                dashAttackRight = 0;
                tempDash = 0;
                dashAerien = 1;
            }
        }
        
        if (!player.body.touching.down && dashAerien== 1)
        {

        }
        else if (player.body.touching.down && dashAerien== 1)
        {
            dashAerien = 0;
        }
    } 



//////////////////////////////////////////////////////////  Control manette //////////////////////////////////////////////////////////

  
    if (paddleConnected == true)
    {
        if (paddle.left )
        {
            player.setVelocityX(-160);

            player.anims.play('left', true);
        }
        
        else if (paddle.right )
        {
            player.setVelocityX(160);

            player.anims.play('right', true);
        }
        
        else
        {
            player.setVelocityX(0);

            player.anims.play('turn');
        }

        if (player.body.touching.down && paddle.A)
            {
                player.setVelocityY(-330);
            }
    }
           
}

function GroundGreen ()
{
    ICE = false; 
    SNOW = false; 
} 

function GroundBlue ()
{
    ICE = true; 
    SNOW = false; 
}    

function GroundWhite ()
{
    ICE = false;
    SNOW = true; 
}  


</script>
</body>
</html>